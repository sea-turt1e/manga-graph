# Neo4j データベース表記揺れ調査レポート

## 調査概要

manga-graphプロジェクトのNeo4jデータベースにおける作者名と漫画名の表記揺れを調査しました。

### 調査環境
- **データベース**: Neo4j (Docker環境)
- **接続情報**: bolt://localhost:7687
- **認証情報**: neo4j/password

## 1. データベース構造

### ノードラベル
- **Work**: 作品情報（id, title, isbn, genre, published_date, cover_image_url, volume等）
- **Author**: 作者情報（id, name, source）
- **Publisher**: 出版社情報（id, name, source）
- **Magazine**: 雑誌情報（現在プロパティなし）
- **Series**: シリーズ情報（id, name, volume_count, publisher, start_date等）

### リレーションシップ
- **CREATED**: Author -> Work（作者が作品を作成）
- **PUBLISHED**: Publisher -> Work（出版社が作品を出版）
- **CONTAINS**: Series -> Work（シリーズが作品を含む）

## 2. 作者名の表記揺れ

### 2.1 主な問題パターン

#### a) 役割プレフィックスの混在
- **問題**: 同じ作者が `[著]`、`[原作]`、`[作画]` などのプレフィックス付きで重複登録されている
- **件数**: 69,763件（全体の約57%）
- **例**:
  - `[著]尾田栄一郎` vs `尾田栄一郎`
  - `[著]吉沢緑時` vs `吉沢緑時`
  - `[著]永尾まる` vs `永尾まる`

#### b) プレフィックスの種類分布（上位10種）
1. `[著]`: 29,104件
2. `[原作]`: 8,689件
3. `[漫画]`: 6,201件
4. `[作画]`: 3,592件
5. `[作]`: 1,752件
6. `[画]`: 1,711件
7. `[監修]`: 1,207件
8. `[キャラクター原案]`: 1,190件
9. `[編]`: 983件
10. `[ほか著]`: 759件

#### c) 文字種の使用状況
- **漢字使用**: 413名（34%）
- **ひらがな使用**: 178名（15%）
- **カタカナ使用**: 593名（49%）
- **アルファベット使用**: 30名（2%）

#### d) 表記の揺れの例
- スペースの有無: `138ネコ` vs `138 ネコ`

### 2.2 正規化処理の現状

`scripts/data_import/name_normalizer.py`で以下の処理を実装済み：
- 役割プレフィックス（`[著]`等）の除去
- 複数作者の分割（カンマ、読点での分割）
- 正規化IDの生成

## 3. 漫画タイトルの表記揺れ

### 3.1 主な問題パターン

#### a) 巻数表記のバリエーション
- **件数**: 10件以上
- **パターン**:
  - 末尾の数字: `サイボーグ009`
  - 第X巻形式: `○○ 第1巻`
  - 括弧付き: `○○ (1)`
  - 英語表記: `○○ vol.1`, `○○ VOLUME 1`

#### b) 同一シリーズの重複登録
- **件数**: 117シリーズ
- **例**:
  - `僕の心のヤバイやつ`（同一タイトルで複数のIDが存在）
  - `SNOOPY`（複数の巻が別々に登録）
  - `逃げ上手の若君`（重複登録）

#### c) 特殊文字の使用
- **件数**: 127件
- **使用文字**: `!`、`?`、`！`、`？`、`・`、`☆`、`★`、`♪` など

#### d) その他の表記揺れ
- 括弧の使用: 1件（`落ちこぼれ衛士見習いの少年。 (実は) 最強最悪の暗殺者。`）

## 4. 出版社名の表記揺れ

### 4.1 読み仮名付き表記
- **問題**: 出版社名に読み仮名が付与されている（`∥`記号で区切り）
- **例**:
  - `集英社　∥　シュウエイシャ`
  - `小学館　∥　ショウガクカン`
  - `講談社　∥　コウダンシャ`
  - `泰光堂　∥　タイコウドウ`
  - `ひばり書房　∥　ヒバリ ショボウ`

### 4.2 正規化処理
`normalize_publisher_name()`関数で`∥`以降を除去する処理を実装済み

## 5. 推奨される改善策

### 5.1 データクレンジング
1. **作者名の統一**
   - 既存の正規化関数を使用して、役割プレフィックスを除去
   - 同一作者の重複エントリーをマージ
   - 作者の役割情報は別プロパティまたはリレーションシップで管理

2. **タイトルの統一**
   - シリーズ作品は`Series`ノードで管理
   - 巻数情報は`volume`プロパティとして分離
   - ベースタイトルを抽出して管理

3. **出版社名の統一**
   - 読み仮名を除去した正規化名で管理
   - 読み仮名は別プロパティとして保存

### 5.2 データモデルの改善提案
1. **作者の役割管理**
   - `CREATED`リレーションシップに`role`プロパティを追加
   - 例: `(Author)-[:CREATED {role: "原作"}]->(Work)`

2. **シリーズ管理の強化**
   - 全ての巻物作品を`Series`ノードに紐付け
   - `Series`ノードに`base_title`プロパティを追加

3. **正規化IDの活用**
   - 全エンティティに正規化IDを付与
   - 重複チェックと統合の自動化

## 6. 結論

現在のデータベースには以下の表記揺れが存在します：
- 作者名: 約57%が役割プレフィックス付きで登録
- 漫画タイトル: 117のシリーズで重複や表記揺れ
- 出版社名: 読み仮名付きの登録が混在

これらの問題は、既に実装されている正規化関数を活用し、データクレンジングとモデルの改善により解決可能です。